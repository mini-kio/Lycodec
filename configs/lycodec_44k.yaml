sample_rate: 44100
stft:
  n_fft: 2048
  hop_length: 588
  win_length: 2048
crop_seconds: 1.5
chunk_seconds: 1.5
hop_seconds: 0.75
batch_size: 4
epochs: 2000
lr: 0.00005
device: cuda
num_workers: 12
save_every: 1000

# ===== Model Configuration (≈131M params) =====
model:
  hidden_dim: 512
  token_dim: 256
  transformer_layers: 8
  heads: 8
  use_rope: true
  token_fps: 24  # Tokens per second (24 fps × 1.5 sec crop = 36 tokens per clip)

  # OPQ-PQ quantizer (4 subspaces × 8-bit codebooks = 32 bits/token)
  pq_M: 4
  pq_K: 256
  ema_decay: 0.97
  awakening_steps: 200
  drop_start: 0.6
  drop_end: 0.25  # Balanced to expose discrete path (was 0.1 -> 0.3 -> 0.25)
  drop_decay_steps: 100000  # Faster dropout decay (was 200000)

  use_residual_corrector: true
  corrector_alpha: 0.2  # Fine-tuned for better balance (was 0.3)

  # Decoder (optimized for 16GB VRAM)
  decoder_depth: 4
  decoder_patch_size: 32
  decoder_embed_dim: 384
  decoder_mlp_ratio: 2.5
  decoder_cond_ch: 32

train:
  grad_clip: 1.0
  use_amp: true
  gradient_accumulation_steps: 4
  use_checkpoint: true

  quantizer_warmup_steps: 1000

  # Loss weight schedules [step, weight]
  residual_weight_schedule:
    - [0, 0.0]
    - [5000, 0.1]
    - [20000, 0.3]
    - [30000, 0.5]

  alignment_weight_schedule:
    - [0, 0.0]
    - [20000, 0.01]

  contrast_weight_schedule:
    - [0, 0.0]
    - [10000, 0.01]
    - [30000, 0.02]

  stereo_corr_weight_schedule:
    - [0, 0.0]
    - [10000, 0.01]
    - [20000, 0.02]
    - [30000, 0.05]
    - [50000, 0.08]

  # Consistency model
  sigma_min: 0.002
  sigma_max: 80.0
  rho: 7.0
  use_ema_teacher: true
  decode_chunk: 2

  ema:
    enabled: true
    decay: 0.995

data:
  wav_exts: [".wav", ".flac", ".mp3"]
  segment_seconds: 1.5
  stereo: true

output:
  ckpt_dir: runs/ckpts
  log_dir: runs/logs
  resume_ckpt: "runs/ckpts/step_52000.pt"  # Latest checkpoint (Oct 29 06:09)

logging:
  use_wandb: true
  project: lycodec
  run_name: lycodec_44k
